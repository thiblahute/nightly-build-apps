APPID=org.pitivi.Pitivi
SDK=org.gnome.Sdk
PLATFORM=org.gnome.Platform
SDK_VERSION=3.18

FORCE=true
FORCE_REBUILD=""

SOURCES[gst-python]="http://gstreamer.freedesktop.org/src/gst-python/gst-python-1.6.1.tar.xz"
CUSTOM_PREPARE[gst-python]="PYTHON=python3 ./configure --prefix=/app --with-pygi-overrides-dir=/app/lib/python3.3/site-packages/gi/"
OPTS[gst-python]="noautogen noconfigure"

SOURCES[gst-editing-services]="http://gstreamer.freedesktop.org/src/gst-editing-services/gstreamer-editing-services-1.6.1.tar.xz"

SOURCES[yasm]="http://www.tortall.net/projects/yasm/releases/yasm-1.3.0.tar.gz"

SOURCES[gst-libav]="http://gstreamer.freedesktop.org/src/gst-libav/gst-libav-1.6.1.tar.xz"
CUSTOM_PREPARE[gst-libav]="export TMPDIR=$PWD && ./configure --prefix=/app/ && make && make install"
OPTS[gst-libav]="noautogen noconfigure"

SOURCES[setuptools]="https://pypi.python.org/packages/source/s/setuptools/setuptools-18.5.tar.gz#md5=533c868f01169a3085177dffe5e768bb"
# FIXME: https://github.com/alexlarsson/gnome-sdk-images/issues/5
# _ssl/_sqlite3.cpython-33m.so is needed and should be part of the Sdk but is not, python was built in the env and the .so copied from there.
CUSTOM_PREPARE[setuptools]="cp ../../_ssl.cpython-33m.so /app/lib/python3.3/site-packages/ && \
  cp ../../_sqlite3.cpython-33m.so /app/lib/python3.3/site-packages/ && \
  PYTHONPATH=/app/lib/python3.3/site-packages/ python3 setup.py install --prefix=/app/  --skip-build"
OPTS[setuptools]="nohelper"

# Adding -L build/temps.linux-x86... because the numpy build system generates it with an '=' (-L=build/temp.linux-x86_64-3.3)
# which makes the build fail
SOURCES[numpy]="https://pypi.python.org/packages/source/n/numpy/numpy-1.10.1.tar.gz#md5=3fed2b50906bc19018cec5fa26168aa5"
CUSTOM_PREPARE[numpy]="ARCHFLAGS='-arch x86_64' CFLAGS=' -L/usr/lib -Lbuild/temp.linux-x86_64-3.3 -I/usr/include -I/usr/include/python3.3m/ ' python3 ./setup.py install --prefix=/app/"
OPTS[numpy]="nohelper"

SOURCES[matplotlib]="https://pypi.python.org/packages/source/m/matplotlib/matplotlib-1.5.0.tar.gz#md5=7952a539418ed77432aa4727409f24cf"
# Needing to specify CC and CXX because otherwise we have --sysroot=/srv/gnome-sdk/gnome-sdk-images/freedesktop-1-2/freedesktop-sdk-base/build/x86_64/tmp-glibc/sysroots/qemux86-64
# in the CPP compiler commands, which leads to all kind of build failures.
CUSTOM_PREPARE[matplotlib]="CXX=/usr/bin/g++ CC=/usr/bin/gcc PYTHONPATH=/app//lib/python3.3/site-packages/ python3 ./setup.py install --prefix=/app/"
OPTS[matplotlib]="nohelper"

SOURCES[gst-plugins-bad]="http://gstreamer.freedesktop.org/src/gst-plugins-bad/gst-plugins-bad-1.6.1.tar.xz"

SOURCES[pitivi]="git://git.gnome.org/pitivi"
CUSTOM_PREPARE[pitivi]="git submodule init && git submodule update && \
  GST_PLUGIN_PATH=/app/lib/gstreamer-1.0 PYTHONPATH=/app/lib/python3.3/site-packages/ ./autogen.sh --prefix=/app && \
  cp ../../pitivi_app /app/bin/"
OPTS[pitivi]="noautogen noconfigure"
SOURCES[pitivi]="git://git.gnome.org/pitivi"

MODULES="gst-editing-services gst-python yasm gst-libav setuptools numpy matplotlib gst-plugins-bad pitivi"
CACHEPOINTS="gst-editing-services gst-python gst-libav yasm setuptools numpy matplotlib gst-plugins-bad"

DESKTOP_FILE=pitivi.desktop
ICON_FILE=pitivi.png
COMMAND=pitivi
